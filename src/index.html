<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Capstone_Design</title>
	<link href="https://fonts.googleapis.com/css?family=Oxygen:300,400" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,700" rel="stylesheet">
	<link rel="stylesheet" href="css/animate.css">
	<!-- <link rel="stylesheet" href="css/icomoon.css"> -->
	<link rel="stylesheet" href="css/bootstrap.css">
	<link rel="stylesheet" href="css/magnific-popup.css">
	<link rel="stylesheet" href="css/flexslider.css">
	<link rel="stylesheet" href="css/style.css">
	<script src="js/modernizr-2.6.2.min.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet">

</head>

<body>

	<div class="fh5co-loader"></div>

	<div id="page">
		<nav class="fh5co-nav " role="navigation">
			<div class="container-wrap" style="background-color: #e3f2fd;">
				<div class="top-menu">
					<div class="row">
						<div class="col-xs-2">
							<div id="fh5co-logo"><a href="index.html" style = "font-family: 'GmarketSansBold';">AI 두피 진단</a></div>
						</div>
						<div class="col-xs-10 text-right menu-1">
							<ul>
								<li class="active" style="font-family: BMDOHYEON;"><a href="index.html">Home</a></li>
								<li style="font-family: BMDOHYEON;"><a href="index.html">About</a></li>
								<li style="font-family: BMDOHYEON;"><a href="index.html">Contact</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</nav>
		<div class="container-wrap">
			<aside id="fh5co-hero">
				<div class="flexslider">
					<ul class="slides">
						<li style="background-image: url(images/portfolio-6.jpg);">
							<div class="overlay-gradient"></div>
							<div class="container-fluid">
								<div class="row">
									<div class="col-md-6 col-md-offset-3 col-md-pull-3 slider-text">
										<div class="slider-text-inner">
											<!--여기에 Contents 작성!!!-->
											<h1>진단</h1>
											<br>
											<video  width="320"
											height="240"
											autoplay
											playsinline
											muted
											id="webcam-container"></video>
											<br>
											<a class="btn btn-primary btn-demo" onclick='(async()=>{await predict();})()'></i>진단</a>
											</div>
									</div>
								</div>
							</div>
						</li>
					</ul>
				</div>
			</aside>
			<div id="fh5co-footer" style="background-color: #e3f2fd">
				<div class="row">
					<div class="col-md-4 text-center animate-box">
						<div class="services">
							<span class="icon">
								<i class="fa-solid fa-lightbulb"></i>
							</span>
							<div class="desc">
								<h3><a href="#" style="font-family: BMDOHYEON;">Purpose</a></h3>
								<p style="font-family: BMDOHYEON; color: rgb(119, 119, 119); opacity: 0.8;">AI를 통해 두피를 진단하여 효율적인 두피 관리가 목적입니다.</p>
							</div>
						</div>
					</div>
					<div class="col-md-4 text-center animate-box">
						<div class="services">
							<span class="icon">
								<i class="fa-solid fa-palette"></i>
							</span>
							<div class="desc">
								<h3><a href="#"style="font-family: BMDOHYEON;">Web Design &amp; UI</a></h3>
								<p style="font-family: BMDOHYEON; color: rgb(119, 119, 119); opacity: 0.8;">HTML5 CSS3 Javascript Bootstrap</p>
							</div>
						</div>
					</div>
					<div class="col-md-4 text-center animate-box">
						<div class="services">
							<span class="icon">
								<i class="fa-solid fa-circle-nodes"></i>
							</span>
							<div class="desc">
								<h3><a href="#"style="font-family: BMDOHYEON;">Development</a></h3>
								<p style="font-family: BMDOHYEON; color: rgb(119, 119, 119); opacity: 0.8;">백엔드 개발-강현우 <br> 프론트앤드 개발-김현우 이주원 정성한 </p>
							</div>
						</div>
					</div>
					<div class="row copyright">
						<div class="col-md-12 text-center">
							<p>
								<small class="block"><br><br>&copy; 2022 Capstone Design 7조</small>
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div><!-- END container-wrap -->


	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="icon-arrow-up2"></i></a>
	</div>

	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Flexslider -->
	<script src="js/jquery.flexslider-min.js"></script>
	<!-- Magnific Popup -->
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/magnific-popup-options.js"></script>
	<!-- Counters -->
	<script src="js/jquery.countTo.js"></script>
	<!-- Main -->
	<script src="js/main.js"></script>
	
	<!-- Tensorflow -->
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
	<script type="text/javascript">
		// More API functions here:
		// https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

		// the link to your model provided by Teachable Machine export panel
		const URL = "../models/";

		let webcam, labelContainer;
		let models = [];
		let disease = [
			'모낭사이홍반',
			'모낭홍반농포',
			'미세각질',
			'비듬',
			'탈모',
			'피지과다'
		]

		let use_webcam = true;
		// now only 1
		const maxPredictions = 4;
		const MODEL_COUNT = 1;
		webcam = document.getElementById('webcam-container');

		// Load the image model and setup the webcam
		async function model_init(ROOT_URL) {
			let model;
			const modelURL = ROOT_URL + "model.json";
			//const metadataURL = ROOT_URL + "metadata.json";
			
			// load the model and metadata
			// Refer to tmImage.loadFromFiles() in the API to support files from a file picker
			// or files from your local hard drive
			// Note: the pose library adds "tmImage" object to your window (window.tmImage)

			model = await tf.loadLayersModel(modelURL);
			console.log(modelURL);
			//maxPredictions = model.getTotalClasses();

			return model;
		}

		async function loop() {
			webcam.update(); // update the webcam frame
			//await predict();
			window.requestAnimationFrame(loop);
		}

		// run the webcam image through the image model
		async function predict() {
			// predict can take in an image, video or canvas html element

			const webcam2 = await tf.data.webcam(webcam, {
				resizeWidth: 224,
				resizeHeight: 224,
			});
			let img = await webcam2.capture();
			const xx = [img];
			for (let m = 0; m < MODEL_COUNT; m++){
				const prediction = await models[m].predict(tf.stack(xx));
				let tensor = await prediction.data();
				let max_idx = 0;
				for (let i = 0; i < maxPredictions; i++) {
					const classPrediction =
						`Model ${disease[m]} / ` + `prob : ${tensor[i]}`;
					console.log(classPrediction);
					if (tensor[i] > tensor[max_idx]){
						max_idx = i;
					}
					//labelContainer.childNodes[i].innerHTML = classPrediction;
				}
				console.log(`Model ${disease[m]} predicted to class ${max_idx}`);
				console.log('=========================');
			}
		}
		
		async function init(){

			for (let i=0; i<MODEL_COUNT; i++){
				const new_URL = URL + `head_model0${i+1}/`;
				models.push(await model_init(new_URL));
			}

			var handleSuccess = function (stream) {
				webcam.srcObject = stream;
			};

			navigator.mediaDevices.getUserMedia({ video: true }).then(handleSuccess);
		}
		


	window.onload = async() => {
		await init();
	}
	</script>
</body>

</html>